"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[957],{31560:function(t,e,n){n.d(e,{I:function(){return a}});var a=(0,n(59496).createContext)(void 0)},85634:function(t,e,n){n.r(e),n.d(e,{default:function(){return ot}});var a=n(15558),r=n.n(a),c=n(26068),o=n.n(c),i=n(90228),s=n.n(i),l=n(87999),u=n.n(l),h=n(48305),p=n.n(h),v=n(31560),d=n(59496),m=Object.defineProperty,f=Object.getOwnPropertySymbols,x=Object.prototype.hasOwnProperty,g=Object.prototype.propertyIsEnumerable,b=(t,e,n)=>e in t?m(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;const _=t=>d.createElement("svg",((t,e)=>{for(var n in e||(e={}))x.call(e,n)&&b(t,n,e[n]);if(f)for(var n of f(e))g.call(e,n)&&b(t,n,e[n]);return t})({viewBox:"0 0 12 12",fill:"none",xmlns:"http://www.w3.org/2000/svg"},t),d.createElement("path",{d:"m11.994 11.537-.82-4.654h.276a.399.399 0 0 0 .403-.396V3.563c0-.219-.18-.395-.403-.395H7.641V.396c0-.22-.18-.396-.402-.396H4.76a.399.399 0 0 0-.402.396v2.772H.549a.399.399 0 0 0-.402.395v2.924c0 .22.18.396.403.396h.277l-.82 4.654A.398.398 0 0 0 .402 12h11.194a.395.395 0 0 0 .396-.463ZM1.23 4.233h4.212V1.067h1.114v3.168h4.212v1.583H1.231V4.234Zm7.246 6.701V8.558a.123.123 0 0 0-.123-.121H7.61a.123.123 0 0 0-.124.121v2.376H4.514V8.558a.123.123 0 0 0-.124-.121h-.744a.123.123 0 0 0-.123.121v2.376h-2.31l.698-3.96h8.177l.698 3.96H8.477Z",fill:"#fff"}));n.p;var w=n(15620),k=n(53913),j=n(69901),y=n(27077),C=n(31262),I=n(93755),Z=n(45041),N=n(32018),E=n(13247),H=n(76334),S=n(6562),O=n(86276),L=Object.defineProperty,A=Object.getOwnPropertySymbols,M=Object.prototype.hasOwnProperty,P=Object.prototype.propertyIsEnumerable,T=(t,e,n)=>e in t?L(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;const G=t=>d.createElement("svg",((t,e)=>{for(var n in e||(e={}))M.call(e,n)&&T(t,n,e[n]);if(A)for(var n of A(e))P.call(e,n)&&T(t,n,e[n]);return t})({viewBox:"0 0 200 200",fill:"none",xmlns:"http://www.w3.org/2000/svg"},t),d.createElement("path",{d:"M0 0h200v200H0z"}),d.createElement("g",{fill:"#fff"},d.createElement("path",{d:"M72.174 121.562c-1.125.636-2.375.954-3.75.954-1.6 0-2.893-.516-3.883-1.547-.984-1.031-1.476-2.396-1.476-4.094 0-1.734.546-3.156 1.64-4.266 1.099-1.114 2.49-1.671 4.172-1.671 1.219 0 2.242.197 3.07.593v1.453c-.906-.573-1.979-.859-3.219-.859-1.255 0-2.283.432-3.085 1.297-.802.864-1.204 1.984-1.204 3.359 0 1.417.373 2.531 1.118 3.344.744.807 1.755 1.211 3.03 1.211.876 0 1.634-.175 2.274-.524v-3.14h-2.453v-1.188h3.766v5.078Zm8.867-2.914h-5.648c.02.891.26 1.579.718 2.063.459.484 1.089.727 1.891.727.901 0 1.73-.297 2.484-.891v1.203c-.703.51-1.633.766-2.789.766-1.13 0-2.018-.362-2.664-1.086-.646-.729-.969-1.753-.969-3.071 0-1.244.352-2.257 1.055-3.039.709-.786 1.586-1.179 2.633-1.179s1.857.338 2.43 1.015c.573.677.859 1.617.859 2.821v.671Zm-1.313-1.086c-.005-.739-.184-1.315-.538-1.726-.35-.412-.837-.617-1.462-.617a2.07 2.07 0 0 0-1.538.648c-.422.432-.683.998-.782 1.695h4.32Zm9.899 4.766h-1.281v-4.562c0-1.698-.62-2.547-1.86-2.547-.64 0-1.172.242-1.593.726-.417.479-.625 1.086-.625 1.821v4.562h-1.282v-8h1.282v1.328h.03c.605-1.01 1.48-1.515 2.626-1.515.875 0 1.544.283 2.008.851.463.563.695 1.378.695 2.446v4.89Zm8.852-3.68H92.83c.02.891.26 1.579.719 2.063.458.484 1.088.727 1.89.727.902 0 1.73-.297 2.485-.891v1.203c-.703.51-1.633.766-2.79.766-1.13 0-2.017-.362-2.663-1.086-.646-.729-.969-1.753-.969-3.071 0-1.244.352-2.257 1.055-3.039.708-.786 1.586-1.179 2.632-1.179 1.047 0 1.857.338 2.43 1.015.573.677.86 1.617.86 2.821v.671Zm-1.313-1.086c-.005-.739-.185-1.315-.539-1.726-.349-.412-.836-.617-1.461-.617a2.07 2.07 0 0 0-1.539.648c-.422.432-.682.998-.781 1.695h4.32Zm7.43-1.937c-.224-.172-.547-.258-.969-.258-.547 0-1.005.258-1.375.774-.365.515-.547 1.218-.547 2.109v4.078h-1.281v-8h1.281v1.649h.031c.183-.563.461-1 .836-1.313a1.897 1.897 0 0 1 1.258-.476c.333 0 .589.036.766.109v1.328Zm7.117 6.703h-1.281v-1.25h-.032c-.557.958-1.377 1.438-2.461 1.438-.796 0-1.421-.211-1.875-.633-.447-.422-.671-.982-.671-1.68 0-1.495.88-2.364 2.64-2.609l2.399-.336c0-1.36-.55-2.039-1.649-2.039-.963 0-1.833.328-2.609.984v-1.312c.786-.5 1.693-.75 2.719-.75 1.88 0 2.82.994 2.82 2.984v5.203Zm-1.281-4.047-1.93.266c-.594.083-1.042.232-1.344.445-.302.209-.453.581-.453 1.117 0 .391.138.711.414.961.281.245.654.368 1.117.368.636 0 1.159-.222 1.571-.665.416-.447.625-1.013.625-1.695v-.797Zm7.406 3.969c-.302.167-.701.25-1.195.25-1.401 0-2.102-.781-2.102-2.344v-4.734h-1.375v-1.094h1.375v-1.953l1.281-.414v2.367h2.016v1.094h-2.016v4.508c0 .536.091.919.274 1.148.182.229.484.344.906.344.323 0 .602-.089.836-.266v1.094Zm2.367-9.953a.81.81 0 0 1-.586-.235.791.791 0 0 1-.242-.593c0-.24.081-.438.242-.594a.801.801 0 0 1 .586-.242c.234 0 .432.081.594.242a.78.78 0 0 1 .25.594.79.79 0 0 1-.25.586.811.811 0 0 1-.594.242Zm.625 10.031h-1.281v-8h1.281v8Zm9.234 0h-1.281v-4.562c0-1.698-.62-2.547-1.859-2.547-.641 0-1.172.242-1.594.726-.417.479-.625 1.086-.625 1.821v4.562h-1.281v-8h1.281v1.328h.031c.604-1.01 1.479-1.515 2.625-1.515.875 0 1.545.283 2.008.851.464.563.695 1.378.695 2.446v4.89Zm9.25-.64c0 2.937-1.406 4.406-4.218 4.406-.99 0-1.854-.188-2.594-.563v-1.281c.901.5 1.76.75 2.578.75 1.969 0 2.953-1.047 2.953-3.141v-.875h-.031c-.609 1.021-1.526 1.532-2.75 1.532-.995 0-1.797-.355-2.406-1.063-.604-.713-.907-1.669-.907-2.867 0-1.359.326-2.44.977-3.242.656-.802 1.552-1.203 2.688-1.203 1.078 0 1.877.432 2.398 1.297h.031v-1.11h1.281v7.36Zm-1.281-2.977v-1.18c0-.635-.216-1.179-.648-1.633-.427-.453-.961-.679-1.602-.679-.791 0-1.411.289-1.859.867-.448.573-.672 1.378-.672 2.414 0 .891.213 1.604.641 2.141.432.531 1.002.797 1.711.797.718 0 1.302-.256 1.75-.766.453-.511.679-1.164.679-1.961Zm4.321 3.789a.843.843 0 0 1-.618-.258.857.857 0 0 1-.25-.617c0-.24.084-.445.25-.617a.832.832 0 0 1 .618-.266.84.84 0 0 1 .625.266.844.844 0 0 1 .257.617c0 .24-.086.445-.257.617a.852.852 0 0 1-.625.258Zm3.468 0a.842.842 0 0 1-.617-.258.853.853 0 0 1-.25-.617c0-.24.083-.445.25-.617a.831.831 0 0 1 .617-.266.84.84 0 0 1 .625.266.84.84 0 0 1 .258.617.84.84 0 0 1-.258.617.85.85 0 0 1-.625.258Zm3.469 0a.84.84 0 0 1-.617-.258.853.853 0 0 1-.25-.617c0-.24.083-.445.25-.617a.83.83 0 0 1 .617-.266.84.84 0 0 1 .625.266.84.84 0 0 1 .258.617.84.84 0 0 1-.258.617.85.85 0 0 1-.625.258ZM94.864 97.259h10.274v2.055H94.864v-2.055ZM96.918 101.369h6.165v2.055h-6.165v-2.055ZM94.674 91.238a7.381 7.381 0 0 1-2.892-6.308A8.23 8.23 0 0 1 100 76.711v-2.055A10.285 10.285 0 0 0 89.727 84.93a9.432 9.432 0 0 0 3.555 7.825c1.04.96 1.582 1.505 1.582 2.45h2.055c0-1.891-1.14-2.945-2.245-3.967ZM105.321 91.242c-1.101 1.02-2.238 2.072-2.238 3.963h2.055c0-.946.54-1.49 1.577-2.452a9.444 9.444 0 0 0 3.56-7.822h-2.055a7.406 7.406 0 0 1-2.899 6.311ZM102.056 78.766h10.274v2.054h-10.274v-2.054Z"})));n.p;var R="view_wrap___qgWqp",U="text_wrap___PKkw4",B="img_wrap___ScPby",F="img_blur___mISN1",V="loading_wrap___RdEw9",W=n(4637),Q=function(t){var e,n=t.msgCode,a=t.msgContentHandle,r=t.nsfwSwitch,c=(-20===n||-22===n?null===(e=JSON.parse(a))||void 0===e?void 0:e[0]:{})||{},o=c.url,i=c.nsfw;return(0,W.jsx)("div",{className:R,children:-20===n||-22===n?(0,W.jsx)(H.Z,{className:"".concat(B," ").concat(1===r&&1===i&&F),src:o,preview:!(1===r&&1===i),placeholder:(0,W.jsx)("div",{className:V,children:(0,W.jsx)("i",{children:(0,W.jsx)(G,{})})})}):(0,W.jsx)("div",{className:U,children:(0,W.jsx)("span",{children:(0,W.jsx)(S.U,{rehypePlugins:[O.Z],children:a})})})})},q="view_wrap___TQUfB",D=function(t){return(0,W.jsxs)("div",{className:q,children:[(0,W.jsx)("div",{}),(0,W.jsx)("div",{}),(0,W.jsx)("div",{})]})},z="view_wrap___AjFNA",J=function(t){var e=t.msgCode,n=t.msgContentHandle;return(0,W.jsx)("div",{className:z,children:(0,W.jsxs)("span",{children:[20===e&&"txt2img ",22===e&&"txt2sticker ",n]})})},K="view_wrap___sBwKl",Y="chat_wrap___fiI6f",X="bottom_wrap___p6aIW",$="button_fun_wrap___ssroV",tt="input_wrap___qA6hU",et="input___QUMJu",nt="input_send___gb6CO",at="input_send_color___jASzZ",rt="input_send_disabled___Hs2ud",ct=C.Z.TextArea,ot=function(t){var e,n=(0,E.useModel)("mini.chat.model"),a=n.records,c=n.CHAT,i=n.RECORD_LIST,l=n.UPDATE,h=n.NEW_SESSION,m=n.nsfw,f=(0,d.useContext)(v.I),x=f.information,g=(f.checkFun,f.INFORMATION),b=x||{},C=b.chatGroupId,H=b.n4UserExpand||{},S=H.botId,O=H.botLevel,L=(0,d.useState)(""),A=p()(L,2),M=A[0],P=A[1],T=(0,d.useReducer)((function(t,e){var n=e.chatLoading;return o()(o()({},t),{},{chatLoading:n})}),{chatLoading:!1},void 0),G=p()(T,2),R=G[0].chatLoading,U=G[1],B=(0,d.useRef)(null),F=(0,d.useRef)(null),V=((0,k.Z)(B)||{}).height,q=(0,d.useState)()||{},z=p()(q,2),ot=z[0],it=void 0===ot?"100%":ot,st=z[1],lt=(0,d.useState)(!1),ut=p()(lt,2),ht=ut[0],pt=ut[1],vt=(0,d.useState)(void 0),dt=p()(vt,2),mt=dt[0],ft=dt[1],xt=w.I_.get("token"),gt=(0,j.Z)(a);return(0,d.useEffect)((function(){S&&C&&i({botId:S,chatGroupId:C})}),[S,C]),(0,d.useEffect)((function(){V&&st("calc(100vh - ".concat(V,"px - 56px - 12px - 22px)"))}),[V]),(0,y.Z)((function(){wt()}),[null==F||null===(e=F.current)||void 0===e?void 0:e.scrollHeight,a]),(0,d.useEffect)((function(){var t=function(){var t=u()(s()().mark((function t(){return s()().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!(Telegram.WebApp.viewportStableHeight-Telegram.WebApp.viewportHeight>=240)){t.next=4;break}return t.next=3,new Promise((function(t){return setTimeout(t,200)}));case 3:wt();case 4:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}();return Telegram.WebApp.onEvent("viewportChanged",t),function(){Telegram.WebApp.offEvent("viewportChanged",t)}}),[]),(0,W.jsxs)("div",{className:K,children:[(0,W.jsxs)("div",{ref:F,style:{maxHeight:it},className:Y,children:[a&&a.map((function(t){var e=t.id;return t.msgCode>0?(0,W.jsx)(J,o()({},t),null!=e?e:(0,N.hQ)(7)):(0,W.jsx)(Q,o()({nsfwSwitch:m},t),null!=e?e:(0,N.hQ)(7))})),R&&(0,W.jsx)(D,{}),!(null==mt||!mt.length)&&(0,W.jsx)(Q,{msgCode:-10,msgContentHandle:mt})]}),(0,W.jsxs)("div",{ref:B,className:X,children:[(0,W.jsxs)("div",{className:$,children:[(0,W.jsx)("img",{src:"".concat(MINI_APP_GLOBAL_URL,"/images/svg/txt2img.svg"),onClick:function(){var t=["txt2img a dog","txt2img a robot","txt2img a cat","txt2img a giraffe","txt2img a girl","txt2img a lion","txt2img a tiger","txt2img a flower","txt2img a butterfly","txt2img a bear","txt2img an alien","txt2img a mountain","txt2img a car","txt2img an ape","txt2img a boy","txt2img a man","txt2img a woman","txt2img a baby","txt2img an elephant","txt2img a puppy"],e=Math.floor(Math.random()*t.length);P(t[e])},alt:""}),(0,W.jsx)("img",{src:"".concat(MINI_APP_GLOBAL_URL,"/images/image/txt2sticker.png"),onClick:function(){if(O>=5){var t=["txt2sticker a furry ghost","txt2sticker a magical unicorn","txt2sticker a pumpkin","txt2sticker a dog","txt2sticker a girl","txt2sticker a lion","txt2sticker a tiger","txt2sticker a flower","txt2sticker a butterfly","txt2sticker a bear","txt2sticker an alien","txt2sticker a mountain","txt2sticker a car","txt2sticker an ape","txt2sticker a boy","txt2sticker a man","txt2sticker a woman","txt2sticker a baby","txt2sticker an elephant","txt2sticker a puppy","txt2sticker a robot","txt2sticker a bee","txt2sticker a giraffe"],e=Math.floor(Math.random()*t.length);P(t[e])}else Z.FN.show("This feature will be unlocked at Level 5.")},alt:""}),(0,W.jsx)(_,{onClick:function(){return pt(!0)}})]}),(0,W.jsxs)("div",{className:tt,children:[(0,W.jsx)(ct,{id:"chat_input",className:et,value:M,onChange:function(t){return R?void 0:P(t.target.value)},onPressEnter:function(){return kt()},placeholder:"Ask me anything",maxLength:1024,showCount:!0,style:{height:60,resize:"none"}}),(0,W.jsx)("i",{className:"fantec_font f_send ".concat(nt," ").concat(!R&&M&&M.length>0?at:rt),onClick:function(t){t.stopPropagation(),kt()}})]})]}),(0,W.jsx)(I.Z,{wrapClassName:"clear-modal-wrap",title:"Clear History",okText:"Clear",open:ht,closable:!1,onOk:u()(s()().mark((function t(){return s()().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,h({botId:S,chatGroupId:C});case 2:i({botId:S,chatGroupId:C}),pt(!1);case 4:case"end":return t.stop()}}),t)}))),onCancel:function(){return pt(!1)},children:(0,W.jsx)("span",{children:"Sure you want to clear all history with the bot ? This action cannot be revoked."})})]});function bt(t){return _t.apply(this,arguments)}function _t(){return(_t=u()(s()().mark((function t(e){var n;return s()().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=r()(e).map((function(t){return isNaN(parseFloat(t))?"[".concat(t.toUpperCase(),"|").concat(t.toLowerCase(),"]"):t})).join(""),t.abrupt("return",new RegExp("(?<![\"'&quot;&#x27;])\\b"+n+"\\b(?![^ ,:])"));case 2:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function wt(){var t,e,n;null!=F&&null!==(t=F.current)&&void 0!==t&&t.scrollHeight&&(null===(e=F.current)||void 0===e||e.scrollTo({top:null===(n=F.current)||void 0===n?void 0:n.scrollHeight,behavior:"auto"}))}function kt(){return jt.apply(this,arguments)}function jt(){return jt=u()(s()().mark((function t(){var e,n,o,h,p,v,d,m,f,x,b,_;return s()().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(M&&null!=M&&M.length&&!R&&(null==mt||!mt.length)){t.next=2;break}return t.abrupt("return");case 2:return U({chatLoading:!0}),n=10,o=M,t.next=6,bt("txt2img");case 6:if(h=t.sent,p=h.exec(M),null===(e=p)||void 0===e||!e.length){t.next=17;break}if(n=20,o=M.replace(h,"").trim(),null!==(v=o)&&void 0!==v&&v.length){t.next=15;break}return Z.FN.show('You need input prompt like "txt2img a cute robot"!'),U({chatLoading:!1}),t.abrupt("return");case 15:t.next=28;break;case 17:return t.next=19,bt("txt2sticker");case 19:if(h=t.sent,p=h.exec(M),null===(d=p)||void 0===d||!d.length){t.next=28;break}if(n=22,o=M.replace(h,"").trim(),null!==(m=o)&&void 0!==m&&m.length){t.next=28;break}return Z.FN.show('You need input prompt like "txt2sticker a cute robot"!'),U({chatLoading:!1}),t.abrupt("return");case 28:return P(""),t.next=31,l({records:[].concat(r()(a),[{id:(0,N.hQ)(7),botId:S,chatGroupId:C,msgCode:n,msgContentHandle:o}])});case 31:if(10!==n){t.next=39;break}f=encodeURIComponent(o),x="".concat(SSE_B,"?msgContentHandle=").concat(f,"&chatGroupId=").concat(C,"&botId=").concat(S,"&token=").concat(xt),b=new EventSource(x),_="",b.onmessage=function(){var t=u()(s()().mark((function t(e){var n,a,r,c;return s()().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!e.data.includes("DONE")){t.next=2;break}return t.abrupt("return");case 2:r=JSON.parse(e.data)||{},c=(null==r||null===(n=r.choices)||void 0===n||null===(n=n[0])||void 0===n||null===(n=n.delta)||void 0===n?void 0:n.content)||(null==r||null===(a=r.output)||void 0===a||null===(a=a.choices)||void 0===a||null===(a=a[0])||void 0===a||null===(a=a.message)||void 0===a?void 0:a.content)||"",ft((function(t){return null!=t?"".concat(t).concat(c):c})),_="".concat(_).concat(c);case 5:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),b.onopen=function(t){U({chatLoading:!1})},b.onerror=function(){var t=u()(s()().mark((function t(e){return s()().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(b.close(),U({chatLoading:!1}),b.readyState!==EventSource.CLOSED){t.next=10;break}return t.next=5,l({records:[].concat(r()(gt.current),[{id:(0,N.hQ)(7),botId:S,chatGroupId:C,msgCode:-10,msgContentHandle:_}])});case 5:g(),ft(void 0),_="",t.next=11;break;case 10:i({botId:S,chatGroupId:C});case 11:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),t.next=48;break;case 39:if(20!==n&&22!==n){t.next=48;break}return t.prev=40,t.next=43,c({botId:S,chatGroupId:C,msgCode:n,msgContentHandle:o});case 43:return t.prev=43,U({chatLoading:!1}),t.finish(43);case 46:i({botId:S,chatGroupId:C}),g();case 48:case"end":return t.stop()}}),t,null,[[40,,43,46]])}))),jt.apply(this,arguments)}}}}]);